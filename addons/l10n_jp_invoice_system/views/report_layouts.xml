<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
        Japan レイアウトの追加。
        まずは標準の Light 相当 (web.external_layout_standard) を継承し、
        レイアウト選択肢として「Japan」を表示できるようにします。

        注意:
        - 表示名は <template name="Japan"> でラジオ選択肢に出ます。
        - 日本固有の詳細調整(登録番号の表示・印影等)は別途テンプレートで拡張予定。
    -->
    <!-- Japan をレイアウト選択肢に追加 -->
    <template id="external_layout_jp" name="Japan" inherit_id="web.external_layout_standard">
        <!-- 会社住所ブロック内に登録番号を追加表示 -->
        <xpath expr="//div[@name='company_address']/ul" position="inside">
            <t t-set="company_jp" t-value="company and (company.company_id if company._name == 'base.document.layout' else company)"/>
            <li t-if="company_jp and company_jp.l10n_jp_registration_number">
                <strong>登録番号:</strong>
                <span t-field="company_jp.l10n_jp_registration_number"/>
            </li>
        </xpath>
        <!-- 会社印（設定されている場合のみ右上に重畳） -->
        <xpath expr="//div[@class='row'][div[@name='company_address']]" position="after">
            <t t-set="company_jp" t-value="company and (company.company_id if company._name == 'base.document.layout' else company)"/>
            <t t-if="company_jp and company_jp.l10n_jp_company_seal">
                <div style="position: relative; height: 0;">
                    <img t-att-src="image_data_uri(company_jp.l10n_jp_company_seal)"
                         style="position:absolute; top:-70px; right:40px; max-width:100px; opacity:0.85;"/>
                </div>
            </t>
        </xpath>
    </template>

    <!-- external_layout でも補助変数を参照できるように（標準踏襲） -->
    <template id="external_layout_jp_base" inherit_id="web.external_layout">
        <xpath expr="//t[@t-if='not company']" position="after">
            <t t-if="o and o.env">
                <t t-set="report" t-value="o.env['ir.actions.report']._get_report_from_name(xmlid)"/>
            </t>
        </xpath>
    </template>
</odoo>
